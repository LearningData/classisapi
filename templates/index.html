<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Classis API</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700,600' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Droid+Serif' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
</head>
<body>
  <nav class="navbar navbar-default">
    <div class="container">
        <a href='/'>Classis API 2.0</a>
    </div>
  </nav>
  <div class="container">
    <form class="pull-right" action="#">
      <fieldset>
        <div class="btn-group format-selection">
          <button class="btn btn-primary" title="Configure your request" onclick="display_auth()">OPTIONS</button>
        </div>
        <div class="btn-group format-selection get">
          <button class="btn btn-primary" title="Make a GET request on the resource" onclick="get_query()">GET</button>
        </div>
        <div class="btn-group format-selection post" style="display: none;">
          <button class="btn btn-primary" title="Make a GET request on the resource" onclick="post_query()">POST</button>
        </div>
      </fieldset>
    </form>
  </div>
  <div class="container auth" style="display: none">
    <div class="input-group">
      <span class="input-group-addon" id="basic-addon1">User</span>
      <input type="text" class="form-control user" aria-describedby="basic-addon1">
      <span class="input-group-addon" id="basic-addon1">Token</span>
      <input type="text" class="form-control token" aria-describedby="basic-addon1">
      <span class="input-group-addon">Method</span>
      <select class="form-control method" onchange="change_method()">
        <option value="get" selected>GET</option>
        <option value="post">POST</option>
      </select>
    </div>
  </div>
  <div class="container post-json" style="display: none">
    <div class="input-group">
      <span class="input-group-addon" id="basic-addon1">JSON</span>
      <textarea class="form-control json" id="json"></textarea>
    </div>
  </div>

  <div class="container" style="padding-top: 25px;">
    <div class="input-group">
      <span class="input-group-addon" id="request">GET:</span>
      <input type="text" class="form-control url" placeholder="/help" aria-describedby="basic-addon1">
      <span class="input-group-addon loading" style="display: none;">
        <i class="fa fa-spinner fa-pulse"></i> Loading...
      </span>
      <span class="input-group-addon success" style="display: none; color: green;">
        Success
      </span>
      <span class="input-group-addon error" style="display: none; color: red;">
        Error
      </span>
    </div>
  </div>
  <div class="container">
      <pre>
        <div id="headers">
          Response:
        </div>
        <div id="response">
        </div>
      </pre>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script>
    function change_method() {
      var method = $('.method').find(':selected').val();
      if(method == 'post') {
        $('.post-json').show();
        $('.get').hide();
        $('.post').show();
        $('#request').html('POST');
      } else {
        $('.post-json').hide();
        $('.post').hide();
        $('.get').show();
        $('#request').html('GET');
      }
    }
    function display_auth() {
      $('.auth').toggle();
    }
    function get_auth() {
      var user = $('.user').val();
      var token = $('.token').val();
      if(user != '' && token != '') {
        return 'user=' + user + '&token=' + token
      }
      return ''
    }
    function display_response(jqXHR) {
      console.log(jqXHR)
      var headers = jqXHR.getAllResponseHeaders();
      $('#headers').html(headers);
      try {
        var response = JSON.parse(jqXHR.responseText);
        response = JSON.stringify(response, null, 4);
        $('#response').html(response);
      } catch(e) {
        console.log(e);
      }
    }
    function get_query() {
      var auth = get_auth();
      var url = $('.url').val()
      if(url != '') {
        $('.error').hide();
        $('.success').hide();
        $('.loading').toggle();
        $.getJSON(url + '?' + auth, function() {
          console.log('success');
        })
        .done(function(data, status, jqXHR) {
          $('#request').css({'color': 'green'})
          display_response(jqXHR);
        })
        .fail(function(jqXHR, textStatus, errorThrown) {
          $('#request').css({'color': 'red'})
          display_response(jqXHR);
        })
        .always(function(resp, status) {
          $('.loading').toggle();
          if(status == 'success') {
            $('.error').hide();
            $('.success').show();
          } else {
            $('.success').hide();
            $('.error').show();
          }
        });
      } else {
        alert('Please enter a valid URL!');
      }
    }
    function post_query() {
      var auth = get_auth();
      var url = $('.url').val()
      var json = $('.json').val()
      if(url != '' && json !='') {
        $('.error').hide();
        $('.success').hide();
        $('.loading').toggle();
        $.ajax({
          url: url + '?' + auth,
          type: 'POST',
          data: json,
          contentType: 'application/json; charset=utf-8',
          dataType: 'json',
          success: function(data) {
            console.log(data);
          }
        })
        .done(function(data, status, jqXHR) {
          $('#request').css({'color': 'green'})
          display_response(jqXHR);
        })
        .fail(function(jqXHR, textStatus, errorThrown) {
          $('#request').css({'color': 'red'})
          display_response(jqXHR);
        })
        .always(function(resp, status) {
          $('.loading').toggle();
          if(status == 'success') {
            $('.error').hide();
            $('.success').show();
          } else {
            $('.success').hide();
            $('.error').show();
          }
        });
      } else {
        alert('Please enter a valid URL and/or JSON!');
      }
    }
  </script>
</body>
</html>
